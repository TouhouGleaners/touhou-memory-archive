from random import random
from pathlib import Path


DB_PATH = Path(__file__).parent.parent / "bili_videos.db"
INIT_SQL_PATH: str = "init.sql" 


# --- 全局行为控制 ---
# 全局最大并发数：所有网络请求、数据库操作都受此限制(fetch_video_list除外)
MAX_CONCURRENCY = 5
# 队列最大容量：防止生产者过快，消耗太多内存
MAX_QUEUE_SIZE = 200


# --- 延迟控制 ---
# 单个API请求之间的随机延迟
DELAY_SECONDS = lambda: uniform(0.1, 0.3)
# 生产者获取每页视频列表后的休眠时间（关键的风控规避策略）
PRODUCER_PAGE_DELAY_SECONDS = 15


# --- 用户切换动态延迟模型配置 ---
USER_SWITCH_CONFIG = {
    'BASE_DELAY': 5.0,          # 基础延迟（秒）：无论上个用户视频多少，也至少要等这么久
    'FACTOR_PER_VIDEO': 0.15,   # 增长因子：上个用户每增加一个视频，延迟就增加这么多秒
    'MAX_DELAY': 180.0,         # 最大延迟（秒）：防止某个用户视频过多（如几千个）导致等待时间无限长
    'JITTER_RATIO': 0.20        # 随机抖动比例：在计算出的延迟基础上，上下浮动的百分比，0.20 表示 ±20%
}


# --- 批量请求特定配置 ---
BATCH_FETCH_CONFIG = {
    'retry_times': 2,  # 针对失败请求的重试次数
    'retry_delay': 10  # 重试时的等待时间（秒）
}


# --- 请求头信息 ---
SESSDATA: str = """"""
HEADERS = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36 Edg/139.0.0.0',
    'Cookie': f'SESSDATA={SESSDATA}',
    'Referer': 'https://www.bilibili.com',
    'Origin': 'https://www.bilibili.com',
    'Accept': 'application/json, text/plain, */*',
    'Connection': 'keep-alive',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'Cache-Control': 'no-cache',
    'Pragma': 'no-cache'
}